<!DOCTYPE html>

<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Fenix A320 Smart Checklist</title>
<!-- iOS & PWA için -->
<link rel="manifest" href="./manifest.json">
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="A320 Checklist" name="apple-mobile-web-app-title"/>
<link href="icons/icon-192.png" rel="apple-touch-icon"/>
<link href="icons/icon-192.png" rel="icon" sizes="192x192" type="image/png"/>
<link href="icons/icon-512.png" rel="icon" sizes="512x512" type="image/png"/>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;family=Oswald:wght@500;700&amp;display=swap" rel="stylesheet"/>
<style>

/* =========================================================
   🎨 TEMA DEĞİŞKENLERİ (Dark & Light) ve TEMEL AYARLAR
   Amaç: Uygulamanın renk paleti, gölge ve radius değerleri
   ========================================================= */

/* Dark Theme (varsayılan) */
:root{
  --bg:#0f1117;              /* Sayfa arka planı */
  --panel:#1c1f26;           /* Panel/kutu arka planı */
  --item:#2a2f3a;            /* Madde arka planı */
  --item-hover:#3b4252;      /* Madde hover rengi */
  --text:#e5e7eb;            /* Genel metin rengi */
  --title:#ffb347;           /* Başlık vurgusu */
  --header:#048CFC;          /* Ana header şeridi */
  --shadow:0 4px 7px rgba(0,0,0,.2); /* Genel gölge */
  --radius-lg:16px;          /* Büyük radius */
  --radius-md:10px;          /* Orta radius */
  --accent:#60a5fa;          /* Vurgu rengi */
  --success:#22c55e;         /* Başarı/Tamamlandı */
}

/* Light Theme (Pastel / Soft) — body üzerine .light geldiğinde değişken override */
body.light {
  --bg: #f5f5f5;                         /* Açık zemin */
  --panel: #ffffff;                      /* Beyaz paneller */
  --item: #e5e7eb;                       /* Açık gri item */
  --item-hover: #d1d5db;                 /* Hover gri */
  --text: #7a7979;                       /* Koyu gri metin */
  --title: #c3c9d4;                      /* Başlık tonu */
  --header: #2a3037;                     /* Üst başlık tonu */
  --shadow: 0 4px 8px rgba(0,0,0,.06);   /* Hafif gölge */
  --accent: #72757d;                     /* Nötr vurgu */
  --success: #059669;                    /* Başarı yeşili */
}

/* ===== Light tema reset butonu daha koyu ===== */
body.light .reset{
  background:#1F2937; /* koyu gri arka plan */
  color:#fff;
}
body.light .reset:hover{
  background:#111827; /* daha koyu hover */
}


/* ---------------------------------------------------------
   📐 GENEL RESET ve GÖVDE
   Amaç: Kutulama modeli ve sayfa temel tipografi/düzeni
   --------------------------------------------------------- */
* { box-sizing: border-box; }

body{
  margin:0; 
  background:var(--bg); 
  color:var(--text);
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  text-align:center;
}

/* ---------------------------------------------------------
   🧭 GLOBAL BAŞLIK (Sayfa üst banner h3)
   Amaç: Sayfa üstündeki büyük bölüm başlığını vurgulamak
   --------------------------------------------------------- */
h3{
  font-family:Oswald, sans-serif;
  font-weight:500;
  font-size:clamp(18px, 4vw, 28px);
  margin: clamp(32px, 5vh, 80px) auto 16px;
  width:min(700px, 92vw);
  padding:12px 16px;
  border-radius:20px;
  background:var(--header);
  box-shadow:var(--shadow);
}

/* ---------------------------------------------------------
   📦 TOPIC KUTULARI (topic-box) ve BAŞLIKLAR
   Amaç: Her konu/grubu çevreleyen kart ve sticky başlık
   --------------------------------------------------------- */
.topic-box{
  width:min(700px, 92vw);
  margin:24px auto 40px;
  padding:16px;
  border-radius:var(--radius-lg);
  background:var(--panel);
  box-shadow:var(--shadow);
  text-align:left;
  position: relative;
}

/* Konu başlığı (sticky + tipografi) */
.topic-box h2{
  font-family: Oswald, sans-serif;
  font-weight: 600;
  letter-spacing: .3px;
  font-size:clamp(16px, 3.5vw, 24px);
  color: var(--title);
  margin: 0;
  padding: 10px 12px;
  background: transparent;
  border-radius: 0px;

  /* sticky davranış ve görsel vurgu */
  position: sticky;
  top: 0;
  z-index: 10;
  box-shadow: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* Konu içi alt başlıklar */
.topic-box h3{
  font-size:clamp(14px, 3.5vw, 20px);
  color: var(--accent);
}

/* ---------------------------------------------------------
   ✅ GÖREV MADDELERİ (item) ve DURUMLAR
   Amaç: Liste maddeleri, hover, içerik hizalama, rozet alanı
   --------------------------------------------------------- */
.item{
  display:block;
  width:100%;
  padding:10px 20px;            /* Tablet dostu daha büyük */
  margin:8px 0;
  border:none;
  border-radius:var(--radius-md);
  background:var(--item);
  color:inherit;
  cursor:pointer;
  box-shadow:var(--shadow);
  text-align:left;
  position: relative;
  font-size:clamp(14px, 3.5vw, 18px);              /* Dokunmatik için daha okunaklı */
}
.item:hover{ background:var(--item-hover); }

/* Madde iç metin ve sağ ikon boşluğu */
.item p {
  margin:0;
  display:flex;
  align-items:center;
  gap:5px;
  line-height:1.35;
  padding-right:35px; /* sağdaki rozet ve ? için alan */
}

/* Metin ile ikon arası noktalı çizgi dolgu */
.dotfill {
  flex: 1 1 auto;
  border-bottom: 2px dotted rgba(255,255,255,.45);
  margin-left: 0;
  margin-right: 0;
  transform: translateY(-2px);
  align-self: flex-end;
}

/* Kritik ve Opsiyonel madde görünümleri */
.item.critical{
  background:#7f1d1d;
  color:#fff;
  border:2px solid #dc2626;
}
.item.optional{
  background:#f3f4f6;
  color:#4b5563;
  border:2px dashed #9ca3af;
}

/* Tamamlanan tekil madde görünümü */
.item.done{
  opacity:.6;
  position:relative;
  outline:2px solid var(--success);
  box-shadow:
    0 0 0 3px color-mix(in srgb, var(--success) 30%, transparent) inset,
    var(--shadow);
}

.item.done{
  padding-left: 36px; /* boşluk bırak */
}
.item.done::after{
  content:"✅";
  position:absolute;
  left:10px;
  top:50%;
  transform: translateY(-50%);
  font-size:18px;
}


/* ---------------------------------------------------------
   ❓ MADDE İÇİ BİLGİ BUTONU
   Amaç: Sağ taraftaki dairesel “?” butonu ve hover hali
   --------------------------------------------------------- */
.info-btn{
  position:absolute;
  right:10px;
  top:50%;
  transform: translateY(-50%);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:28px; height:28px;
  border-radius:50%;
  background:rgba(255,255,255,.08);
  border: 1px solid #4b5563;
  font-weight:700;
  font-size:14px;
  line-height:1;
  cursor:pointer;
  user-select:none;
}
.info-btn:hover{ background:rgba(255,255,255,.16); }

/* ---------------------------------------------------------
   🔄 RESET BUTONLARI
   Amaç: Listeyi/ilerlemeyi sıfırlayan butonlar
   --------------------------------------------------------- */
.reset{
  display:block;
  margin: 12px auto 0;
  text-align: center;
  font-weight: 600;
  font-size:clamp(14px, 3.5vw, 18px);
  padding: 12px 18px;
  border:none;
  border-radius:10px;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
  box-shadow:var(--shadow);
}
.reset:hover{ background:#1d4ed8; }

/* Global reset tetikleyici (ID bazlı) */
#globalReset { cursor: pointer; }

/* ---------------------------------------------------------
   🏁 TAMAMLANMA DURUMU (TOPIC SEVİYESİ)
   Amaç: Bir konudaki tüm maddeler tamamlandığında başlık stili
   --------------------------------------------------------- */
.completed{
  outline:2px solid #22c55e55;
  box-shadow:0 0 0 3px #22c55e22 inset, var(--shadow);
}
.completed h2{ color: var(--success) !important; }
.completed h2::after{
  content:"CHECKLIST COMPLETED";
  color: var(--success) !important;
  font-weight:700;
  margin-left:0px;
  display:inline-block;
}

/* ---------------------------------------------------------
   🪟 MODAL / AÇIKLAMA PENCERELERİ (Madde açıklamaları)
   Amaç: Overlay, kart, başlık, gövde, alt kısım ve butonlar
   --------------------------------------------------------- */

/* Genel modal örtüsü */
.modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 16px;
  z-index: 50;
}
.modal.show{ display:flex; }

/* Modal kartı */
.modal-card{
  width:min(720px, 96vw);
  max-height: 85vh;
  overflow:auto;
  background: #0f141b;
  color: var(--text);
  border-radius: 16px;
  box-shadow: var(--shadow);
  border:1px solid rgba(255,255,255,.08);
}

/* Modal başlık çubuğu (sticky) */
.modal-header{
  /* child layout: [modal-left] [modal-actions] [close-btn] */
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 18px;
  border-bottom:1px solid rgba(255,255,255,.08);
  background: #101826;
  position: sticky;
  top:0;
}

/* Modal başlık metni */
.modal-title{
  font-family: Oswald, sans-serif;
  font-size:clamp(14px, 3.5vw, 20px);
  color: var(--title);
}

/* Modal gövde metni */
.modal-body{
  padding:16px 18px 22px;
  line-height:1.55;
  white-space: pre-wrap;
  text-align: justify;
}
.modal-body ul { list-style-type: disc; padding-left: 20px; margin: 0; }
.modal-body li { margin-bottom: 4px; }

/* Kapatma butonu (X) */
.close-btn{
  border:none;
  background:transparent;
  color:var(--text);
  font-size:22px;
  cursor:pointer;
  width:32px; height:32px;
  border-radius:8px;
}
.close-btn:hover{ background:rgba(255,255,255,.08); }

/* Left cluster in modal header: title + delete button */
.modal-left{ display:flex; align-items:center; gap:8px; }

/* Modal alt buton alanı ve kopyalama butonu */
.modal-footer{
  padding:10px 18px 16px;
  border-top:1px solid rgba(255,255,255,.08);
  display:flex;
  justify-content:flex-end;
  gap:8px;
}
.copy-btn{
  border:none;
  border-radius:10px;
  padding:10px 14px;
  cursor:pointer;
  background: #1f2937;
  color: var(--text);
}
.copy-btn:hover{ background:#374151; }

/* ---------------------------------------------------------
   📑 DOKÜMAN BİLGİSİ POPUP (Sadece #topic1 için)
   Amaç: Sağ üst info butonu ve onun açtığı modal
   --------------------------------------------------------- */

/* Sağ üst “info” butonu — yalnızca #topic1 */
#topic1 .doc-info-btn{
  position:absolute;
  top:10px; right:12px;
  width:50px; height:32px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:var(--text);
  font-weight:600;
  cursor:pointer;
  z-index:2;
}
#topic1 .doc-info-btn:hover{ background:rgba(255,255,255,.12); }

/* Doküman Özellikleri popup overlay */
#docInfoModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}
#docInfoModal.show{ display:flex; }

/* Doküman Özellikleri kutusu */
#docInfoModal .box{
  width:min(600px,90vw);
  background:#0f141b;
  color:var(--text);
  border-radius:12px;
  padding:20px;
  box-shadow:var(--shadow);
  text-align:justify;
}
#docInfoModal h4{ margin-top:0; color:var(--title); }
#docInfoModal .close{
  float:right;
  background:none; border:none;
  color:var(--text);
  font-size:20px;
  cursor:pointer;
}


/* ---------------------------------------------------------
   🔹 ALT LİSTELER, SÜRÜM ÇUBUĞU ve UTILITIES
   --------------------------------------------------------- */
.sub-list li{
  margin-bottom: 10px;
  font-size:clamp(12px, 3vw, 16px);
  font-weight: 400;
}

.version-bar{
  width:min(700px, 92vw);
  margin: -10px auto 14px;
  font-size: 13px;
  opacity:.9;
  color: var(--text);
}
.version-bar .sep{ margin:0 6px; opacity:.7; }
body.light .version-bar{ opacity:.95; }

/* Görünmez yardımcı sınıf */
.hidden{ display:none !important; }

/* ---------------------------------------------------------
   📱 MOBİL DÜZEN İYİLEŞTİRMELERİ
   --------------------------------------------------------- */
@media (max-width: 640px){
  .topic-box{ padding:18px; }
  .item{ margin:14px 0; padding:20px 22px; }
  .sub-list li{ margin-bottom:12px; }
  .reset{ margin-top:16px; padding:12px 18px; }
}




/* ===== Light tema ek kontrast iyileştirmeleri ===== */
body.light .info-btn{
  background: rgba(0,0,0,.08);
  border: 1px solid rgba(0,0,0,.25);
  color: #111; /* simge daha koyu */
}
body.light .info-btn:hover{
  background: rgba(0,0,0,.18);
}

body.light .sub-list li{
  color:#1F2937; /* alt liste metinleri daha koyu */
}

body.light .dotfill{
  border-bottom-color: rgba(0,0,0,.4);
}

body.light .modal-title{
  color:#1E3A8A; /* koyu mavi başlık */
}

body.light .topic-box h2{
  color:#0F172A; /* bölümler için koyu başlık */
}


/* === Actions row (Reset + Add Row) === */
.actions{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  margin-top:8px;
  width:100%;
}
.actions .reset{
  margin:0;
}
.add-row{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  font-size:16px;
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#16a34a;
  color:#fff;
  cursor:pointer;
  box-shadow:var(--shadow);
}
.add-row:hover{ background:#15803d; }

.reset, .add-row{
  font-size:14px;
  padding:8px 14px;
  border-radius:10px;
}

/* Modal header actions */
.modal-actions .copy-btn{
  padding:8px 12px;
  font-size:14px;
}



/* === Top Controls (Theme, Save, Restore) aligned === */
#topControls{
  position: relative;
  margin: 16px auto 24px;
  display:flex;
  gap:8px;
  justify-content:center;
  align-items:center;
  z-index:10;
}
#topControls button{
  width:48px; height:48px;
  font-size:20px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.15);
  background:rgba(255,255,255,.3);
  backdrop-filter:blur(6px);
  cursor:pointer;
  transition:all .2s ease;
}
#topControls button:hover{
  background:rgba(255,255,255,.6);
  transform:scale(1.05);
}


#infoModal .modal-body{ line-height:1.2; }
#infoModal .modal-body ul{ padding-left: 20px; margin: 0; }
#infoModal .modal-body li{ margin-bottom:0; }


/* === Responsive modal & buttons & icons === */
.modal-title {
  font-size: clamp(14px, 3.5vw, 20px);
}
.modal-body {
  font-size: clamp(12px, 3.5vw, 16px);
  line-height: 1.4;
}
.modal-body li {
  font-size: clamp(12px, 3.5vw, 15px);
}
.copy-btn {
  font-size: clamp(12px, 3vw, 14px);
  padding: clamp(6px, 2vw, 10px) clamp(10px, 3vw, 14px);
}
.close-btn {
  font-size: clamp(18px, 5vw, 22px);
  width: clamp(24px, 7vw, 32px);
  height: clamp(24px, 7vw, 32px);
}
.info-btn {
  width: clamp(20px, 7vw, 28px);
  height: clamp(20px, 7vw, 28px);
  font-size: clamp(12px, 4vw, 14px);
}

</style>
</head>
<body>
<h3 id="globalReset">FENIX A320 SMART CHECKLIST</h3>
<div id="topControls"><button id="infoToggle">ℹ️</button><button id="themeToggle">☀️</button><button id="exportToggle">💾</button><button id="restoreToggle">⟲</button></div>
<section aria-label="AIRCRAFT POWER" class="topic-box" id="topic1">
<h2>AIRCRAFT POWER</h2>
<button class="item"><p>EXTERNAL POWER ON</p></button>
<button class="item"><p>BAT 1 &amp; 2 ON</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="EFB INITIALIZATION" class="topic-box" id="topic2">
<h2>EFB INITIALIZATION</h2>
<button class="item simbrief"><p>SIMBRIEF DATA IMPORT</p></button>
<button class="item"><p>GROUND SERVICES SET</p></button>
<button class="item"><p>MASS AND BALANCE LOAD</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="OVERHEAD PREPARATION" class="topic-box" id="topic3">
<h2>OVERHEAD PREPARATION</h2>
<button class="item">
<!-- Alt maddeler -->
<ul class="sub-list">
<li> CREW SUPPLY  ON</li>
<li> GND CTL ON</li>
<li> CVR TEST PERFORM</li>
<li> EVAC SWITCH  CAPT</li>
<li> ADIRS  NAV</li>
<li> EMER EXIT LT ARM</li>
<li> NO SMOKING AUTO</li>
<li> SEAT BELTS ON</li>
<li> NAV &amp; LOGO LT POSITION 1</li>
<li> FUEL PUMPS ON </li>
</ul>
</button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="MCDU DIFSRIPP SETUP" class="topic-box" id="topic4">
<h2>MCDU DIFSRIPP SETUP</h2>
<button class="item"><p>DATA  CHECK DATABASE</p></button>
<button class="item"><p>INIT (A Page)  INIT REQUEST</p></button>
<button class="item"><p>F-PLN  SET DEP / ARR</p></button>
<button class="item"><p>SEC F-PLN  COPY ACTIVE</p></button>
<button class="item"><p>RAD NAV  FORCE NEARBY</p></button>
<button class="item"><p>INIT (B Page)  SET</p></button>
<button class="item"><p>PERF  SET</p></button>
<button class="item"><p>PROG  SET</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="CENTER PEDESTAL SETUP" class="topic-box" id="topic5">
<h2>CENTER PEDESTAL SETUP</h2>
<button class="item">
<!-- Üst satır -->
<div class="header-line">
<span class="l">RADIO MANAGEMENT AND AUDIO CONTROL PANEL (RMP &amp; ACP)</span>
<span aria-hidden="true" class="dotfill"></span>
</div>
<!-- Alt maddeler -->
<ul class="sub-list">
<li> VATSIM Frequency SET</li>
<li> VHF1 &amp; VHF2 KNOB ON</li>
<li> INT &amp; CAB KNOB ON</li>
<li> PA KNOB ON</li>
<li> VHF1 SELECTED ON RIGHT SIDE (If you are flying as a co-pilot) </li>
<li> TCAS ON</li>
</ul>
</button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="Pre-Departure Clearance (CPDLC)" class="topic-box" id="topic6">
<h2>Pre-Departure Clearance (CPDLC)</h2>
<button class="item">
<!-- Alt maddeler -->
<ul class="sub-list">
<li> CHECK ATIS &amp; METAR</li>
<li> STAND NUMBER | DESTINATION | INFORMATION (for voice clearance)</li>
<li> MCDU MENU &gt; ATSU &gt; AOC MENU &gt; FLT INIT &gt; INIT DATA REQ</li>
<li> MCDU MENU &gt; ATSU &gt; AOC MENU &gt; ATC REQ &gt; PRE DEP CLRNCE &gt; FILL &gt; SEND </li>
<li> DEPARTURE SID  CHECK &amp; SET</li>
<li> SQUAWK SET</li>
<li> BARO REF  SET BOTH</li>
<li> INITIAL CLIMB  SET</li>
</ul></button><button class="item"><p>APU START</p></button>
<button class="item"><p>APU BLEED ON</p></button>
<button class="item"><p>EXTERNAL POWER OFF</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="PUSHBACK AND STARTUP" class="topic-box" id="topic7">
<h2>PUSHBACK AND STARTUP</h2>
<button class="item"><p>GROUND CONNECTIONS  REMOVE</p></button>
<button class="item"><p>WINDOWS/DOORS  CLOSED (BOTH)</p></button>
<button class="item"><p>PUSHBACK TUG  CONNECT</p></button>
<button class="item"><p>PARKING BRAKE OFF</p></button>
<button class="item"><p>TCAS TA/RA</p></button>
<button class="item"><p>BEACON  ON</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="AFTER START" class="topic-box" id="topic8">
<h2>AFTER START </h2>
<button class="item"><p>ANTI ICE  ____</p></button>
<button class="item"><p>ECAM STATUS  CHECKED</p></button>
<button class="item"><p>PITCH TRIM  ____%</p></button>
<button class="item"><p>RUDDER TRIM NEUTRAL</p></button>
<button class="item"><p>FLIGHT CONTROLS CHECKED(BOTH)</p></button>
<button class="item"><p>FLIGHT INST CHECKED(BOTH)</p></button>
<button class="item"><p>FLAPS SETTING  CONF ____(BOTH)</p></button>
<button class="item"><p>RADAR &amp; PRED W/S  ON &amp; ON</p></button>
<button class="item"><p>ENG MODE SEL ____</p></button>
<button class="item"><p>APU OFF</p></button>
<button class="item"><p>APU BLEED OFF</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="TAXI" class="topic-box" id="topic9">
<h2>TAXI</h2>
<button class="item">
<!-- Üst satır -->
<div class="header-line">
<span class="l">ECAM MEMO</span>
<span aria-hidden="true" class="dotfill"></span>
<span class="r">TO NO BLUE</span>
</div>
<!-- Alt maddeler -->
<ul class="sub-list">
<li> AUTO BRK MAX</li>
<li> SEAT BELTS ON</li>
<li> CABIN READY</li>
<li> SPLRS ARM</li>
<li> FLAPS T.O</li>
<li> T.O CONFIG NORMAL</li>
</ul>
</button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="LINE-UP" class="topic-box" id="topic10">
<h2>LINE-UP </h2>
<button class="item"><p>T.O RWY ____(BOTH)</p></button>
<button class="item"><p>CABIN CREW  ADVISED</p></button>
<button class="item"><p>PACKS 1 &amp; 2 ____</p></button>
<button class="item"><p>ALL LIGHTS  ON</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="DEPARTURE CHANGE" class="topic-box" id="topic11">
<h2>DEPARTURE CHANGE</h2>
<button class="item"><p>RWY &amp; SID &amp; NADP ____</p></button>
<button class="item"><p>FLAPS SETTING  CONF ____ (BOTH)</p></button>
<button class="item"><p>T.O SPEEDS &amp; THRUST ____(BOTH)</p></button>
<button class="item"><p>FCU ALT ____</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="APPROACH" class="topic-box" id="topic12">
<h2>APPROACH</h2>
<button class="item"><p>BARO REF ____(BOTH)</p></button>
<button class="item"><p>SEAT BELTS  ON</p></button>
<button class="item"><p>MINIMUM ____</p></button>
<button class="item"><p>AUTO BRAKE ____</p></button>
<button class="item"><p>ENG MODE SEL ____</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="LANDING" class="topic-box" id="topic13">
<h2>LANDING</h2>
<button class="item">
<!-- Üst satır -->
<div class="header-line">
<span class="l">ECAM MEMO</span>
<span aria-hidden="true" class="dotfill"></span>
<span class="r">LDG NO BLUE</span>
</div>
<!-- Alt maddeler -->
<ul class="sub-list">
<li>LDG GEAR DN</li>
<li>SEAT BELTS  ON</li>
<li>CABIN READY</li>
<li>SPLRS ARM</li>
<li> FLAPS FULL or CONF 3</li>
</ul>
</button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="AFTER LANDING" class="topic-box" id="topic14">
<h2>AFTER LANDING</h2>
<button class="item"><p>RADAR &amp; PRED W/S OFF</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="PARKING" class="topic-box" id="topic15">
<h2>PARKING</h2>
<button class="item"><p>PARK BRK OR CHOCKS SET</p></button>
<button class="item"><p>ENGINES OFF</p></button>
<button class="item"><p>WING LIGHTS OFF</p></button>
<button class="item"><p>FUEL PUMPS OFF</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<section aria-label="SECURING THE AIRCRAFT" class="topic-box" id="topic16">
<h2>SECURING THE AIRCRAFT</h2>
<button class="item"><p>PARKING BRAKE  SET</p></button>
<button class="item"><p>ADIRS  OFF</p></button>
<button class="item"><p>OXYGEN OFF</p></button>
<button class="item"><p>EMER EXIT LT OFF</p></button>
<button class="item"><p>EFBs  OFF (BOTH)</p></button>
<button class="item"><p>APU AND BATTERIES OFF</p></button>
<button class="reset" data-reset="">Reset</button>
</section>
<!-- Madde açıklama Modal (QUESTION/?) -->
<div aria-labelledby="descTitle" aria-modal="true" class="modal" id="descModal" role="dialog">
<div class="modal-card">
<div class="modal-header"><div class="modal-left"><div class="modal-title" id="descTitle">Title</div><button class="copy-btn" id="editItemBtn" style="background:#1f2937;border:1px solid #555;font-size:14px;padding:6px 12px;line-height:1;min-width:100px;text-align:center;margin-left:6px;">Edit Item</button> <button class="copy-btn" id="deleteItemBtn" style="background:#7f1d1d;border:1px solid #dc2626;font-size:14px;padding:6px 12px;line-height:1;min-width:100px;text-align:center;">Delete Item</button></div><button aria-label="Kapat" class="close-btn">×</button></div>
<div class="modal-body" id="descBody">İçerik</div>
<div class="modal-footer">
<button class="copy-btn" id="editBtn" style="margin-right:auto;">Update Note</button>
<button class="copy-btn" id="saveEditBtn" style="display:none;">Save</button>
<button class="copy-btn" id="copyBtn">Complete</button>
</div>
</div>
</div>
<!-- Doküman Özellikleri Popup (sade, içerik senin) -->

<!--
📚 Amaç: Checklist uygulamasının JS mantığını düzenli, net ve erişilebilir bir yapıda sunmak.
Sıra: Yardımcılar → Veri → DOM Referansları → Modal Yardımcıları → Builder/Logic → Event Wiring → Init → Ek Özellikler
-->
<script>
/* =========================================================
   🔧 YARDIMCI FONKSİYONLAR
   - normalizeKey: Anahtarları tekilleştirir (boşlukları normalize eder)
   ========================================================= */
const normalizeKey = (s) => (s || "").replace(/\s+/g, " ").trim();

/* =========================================================
   📒 FCOM / AÇIKLAMA VERİLERİ
   - FCOM_NOTES_RAW: Başlık → HTML açıklama metni
   - FCOM_NOTES: normalize edilmiş sözlük (erişim kolaylığı)
   ========================================================= */
const FCOM_NOTES_RAW = {
  "EXTERNAL POWER ON":"Connect EXT PWR when available and within limits. When ON, AC buses are powered by GPU unless engine generators are online. Verify on ELEC page that EXT PWR is supplying and parameters are within range.",
  "BAT 1 & 2 ON":"Before long downtime starts, check battery voltage (>25.5 V) then set to AUTO. With AUTO selected, contactors close for charge. Limit time on batteries alone; start APU promptly if needed.",
  "DATA  CHECK DATABASE":"On MCDU DATA/STATUS verify airframe/engine variant and NAV database validity (cycle/date). Discrepancy requires maintenance or data reload before dispatch.",
  "INIT (A Page)  INIT REQUEST":"Fill or request basic flight data: dep/arr aerodromes, alternate, flight number, CI, cruise level/temperature. Cross-check with operational flight plan.",
  "F-PLN  SET DEP / ARR":"Insert SID, enroute segments and expected STAR/runway. Ensure discontinuities resolved as needed and any ATC constraints are reflected.",
  "SEC F-PLN  COPY ACTIVE":"Use secondary for contingency (e.g., return or diversion). Copy active plan or build alternate; arm for quick activation during abnormal situations.",
  "RAD NAV  FORCE NEARBY":"Manual tune VOR/ILS as required (e.g., departure aid or nav signal protection). Clear manual tuning when no longer needed to restore autotune.",
  "INIT (B Page)  SET":"Enter ZFW/ZFWCG, block fuel or FOB as applicable. Check GW and CG computed by FMGC against loadsheet. Ensure prediction values update.",
  "PERF  SET":"Enter TO/CLB/CRZ/LAND parameters: flap/THR RED/ACC altitudes, flex or TOGA strategy, V1/Vr/V2, approach profile and autobrake as planned.",
  "PROG  SET":"Monitor BRG/DIST references, step climbs, predicted fuel/time. Insert expected cruise wind/temp if required by SOPs to refine predictions.",
  "SIMBRIEF DATA IMPORT":"Import Simbrief Data from My Flights page.<br><a href=\"https://dispatch.simbrief.com/home\" target=\"_blank\">Open Simbrief Dispatch</a>",
  "GROUND SERVICES SET":"Configure chocks, GPU, air/conditioning and doors according to turn-around phase. Remove equipment prior pushback per SOP.",
  "MASS AND BALANCE LOAD":"Load payload and fuel (instant/fast/real-time). Confirm loadsheet values and ensure MCDU GW/CG match within tolerance.",
  "RADIO MANAGEMENT AND AUDIO CONTROL PANEL (RMP & ACP)":"Set active VHF according to crew role; adjust ACP volumes/sources. Confirm intercom/PA as needed. For online networks, verify COM1/COM2 mapping.",
  "VATSIM Frequency SET":"Tune clearance/ground/tower per airport charts or network info. Maintain correct mic select and monitor guard if company procedures require.",
  "VHF1 & VHF2 KNOB ON":"Enable transceivers; select primary TX on the intended radio. Check sidetone and volume.",
  "INT & CAB KNOB ON":"Enable interphone/cabin channels as required for crew coordination; set volumes to avoid masking alerts.",
  "PA KNOB ON":"Arm/adjust PA for announcements; ensure it does not inhibit critical aural alerts during takeoff/landing.",
  "VHF1 SELECTED ON RIGHT SIDE (If you are flying as a co-pilot)":"Right seat selects the appropriate TX source to avoid dual-keying; confirm cross-cockpit communication.",
  "TCAS ON":"Set TCAS to STBY before push; TA/RA for takeoff. Verify transponder code and mode; ensure correct altitude reporting.",
  "CHECK ATIS & METAR":"Review weather/NOTAMs. Confirm QNH, winds, significant WX affecting performance or departure routing.",
  "STAND NUMBER | DESTINATION | INFORMATION (for voice clearance)":"Prepare standard phraseology items to expedite clearance readback and reduce frequency time.",
  "MCDU MENU > ATSU > AOC MENU > FLT INIT > INIT DATA REQ":"Request initial data via ACARS/AOC if available; verify uplinked routing and weights before acceptance.",
  "MCDU MENU > ATSU > AOC MENU > ATC REQ > PRE DEP CLRNCE > FILL > SEND":"Request PDC when supported. Review route, SID, squawk. Load to F-PLN only after verifying constraints.",
  "DEPARTURE SID  CHECK & SET":"Confirm assigned SID in F-PLN, altitude/speed constraints, and engine-out procedure awareness.",
  "SQUAWK SET":"Set assigned code; verify XPDR AUTO or ON as per taxi/takeoff phase. Cross-check by both pilots.",
  "BARO REF  SET BOTH":"Set local QNH on both PFDs; check altimeter cross-check within tolerance before takeoff/approach.",
  "INITIAL CLIMB  SET":"Set cleared initial altitude/heading in FCU; brief any stop altitude or noise abatement.",
  "APU START":"Start when needed for electrics/air. Monitor EGT and AVAIL; ensure APU BLEED configuration before engine start.",
  "APU BLEED ON":"Select BLEED ON to supply packs or engine start air. Verify pack/bleed configuration to avoid pressure/temperature excursions.",
  "EXTERNAL POWER OFF":"Disconnect before push/start if APU or GPU no longer required; check ELEC page for correct source transfer.",
  "GROUND CONNECTIONS  REMOVE":"Remove chocks/GPU/air and close doors before pushback; confirm on ECAM WHEEL/DOOR pages.",
  "WINDOWS/DOORS  CLOSED (BOTH)":"Cabin/flight deck doors and windows closed and locked; check ECAM MEMO status shows no door/slide warnings.",
  "PUSHBACK TUG  CONNECT":"Request and confirm tug status/route. Ensure parking brake set before pushback commences.",
  "PARKING BRAKE OFF":"Release on tug instruction; monitor brake pressure and confirm movement.",
  "TCAS TA/RA":"Before line-up, set TA/RA; verify transponder to AUTO/TA/RA.",
  "BEACON  ON":"Select BEACON ON prior push/start to signal ground personnel.",
  "ANTI ICE  ____":"Apply ENG/WING anti-ice per OAT/visible moisture/icing conditions. Monitor ICE DET and engine parameters.",
  "ECAM STATUS  CHECKED":"After start, review STATUS for inoperative systems or deferred items; action required procedures.",
  "PITCH TRIM  ____%":"Set stabilizer per PERF/TO data; cross-check both sides.",
  "RUDDER TRIM NEUTRAL":"Verify centered prior to taxi; avoids takeoff roll asymmetry.",
  "FLIGHT CONTROLS CHECKED(BOTH)":"Full and free movement; check F/CTL page for correct deflections and spoilers.",
  "FLIGHT INST CHECKED(BOTH)":"PFD/ND alignment, FMA/FD modes, QNH, heading, IRS alignment verified.",
  "FLAPS SETTING  CONF ____(BOTH)":"Set planned flap conf; check ECAM/Flap scale indications and takeoff speeds.",
  "RADAR & PRED W/S  ON & ON":"Arming weather radar and predictive windshear per SOP; avoid sweeping on stand facing terminals.",
  "ENG MODE SEL ____":"Set IGN/START for engine start or NORM otherwise per phase.",
  "APU OFF":"After engine start and electrical/bleed transfer, stop APU unless needed.",
  "APU BLEED OFF":"Select OFF when engine bleeds/packs configured for taxi/takeoff.",
  "ECAM MEMO":"Taxi/TO MEMO should display 'TO NO BLUE' before line-up; resolve any blue items prior to takeoff.",
  "AUTO BRK MAX":"Set per takeoff performance/contaminated runway policy or RTO strategy.",
  "SEAT BELTS ON":"Cabin signs ON before taxi/takeoff; advise cabin crew.",
  "CABIN READY":"Obtain cabin ready from purser before line-up.",
  "SPLRS ARM":"Arm spoilers for automatic deployment on reject/landing as applicable.",
  "FLAPS FULL or CONF 3":"Configure landing flaps per performance/NOTAM; verify speed constraints.",
  "RADAR & PRED W/S OFF":"After landing clear of runway, select off as per SOP to avoid ramp irradiation.",
  "PARK BRK OR CHOCKS SET":"At stand, set PBK or install chocks; confirm ECAM memo.",
  "ENGINES OFF":"Fuel levers OFF; monitor spool-down and status.",
  "WING LIGHTS OFF":"Set exterior lights per ramp safety; strobe off after vacating runway.",
  "FUEL PUMPS OFF":"Switch off as required after shutdown unless fuel transfer needed.",
  "PARKING BRAKE  SET":"Before securing, set brake if chocks not in place.",
  "ADIRS  OFF":"If aircraft fully secured, switch IRS OFF; observe alignment status before power down.",
  "OXYGEN OFF":"Shut off crew oxygen if required by securing procedure.",
  "EMER EXIT LT OFF":"Select OFF when aircraft is fully powered down and at gate as per SOP.",
  "EFBs  OFF (BOTH)":"Shut down portable devices or stow; avoid battery drain.",
  "APU AND BATTERIES OFF":"When ground power available and checks complete, stop APU and set BAT to OFF.",
};

const FCOM_NOTES = Object.fromEntries(
  Object.entries(FCOM_NOTES_RAW).map(([k, v]) => [normalizeKey(k), v])
);

/* =========================================================
   📦 GRUP NOTLARI (Alt listeler için toplu açıklamalar)
   - topic başlığına göre modalda madde+not listesi üretir
   ========================================================= */
const GROUP_NOTES = {
  "OVERHEAD PREPARATION": [
    { title: "CREW SUPPLY ON", notes: [
      "CREW OXY pb ON: supply pressurized oxygen to masks.",
      "Check OXY pressure on DOOR/OXY page (value depends on temperature).",
    ]},
    { title: "GND CTL ON", notes: [
      "On ground, when GND CTL pb-sw is pressed, the CVR is recording.",
    ]},
    { title: "CVR TEST PERFORM", notes: [
      "When pressed and held:This activates the test, if the CVR is on (the GND CTL pb-sw pressed, or during the first 5 min after energization of the aircraft electrical network), and the parking brake is on.",
    ]},
    { title: "EVAC SWITCH CAPT", notes: [
      "EVAC CMD switch guarded and in CAPT position.",
      "Prevents inadvertent cabin-initiation when not intended."
    ]},
    { title: "ADIRS NAV", notes: [
      "Select all three IR mode selectors to NAV.",
      "Alignment ~10 min (fast align if needed); monitor IRS status on MCDU/ND."
    ]},
    { title: "EMER EXIT LT ARM", notes: [
      "ARM so emergency lights illuminate automatically if DC power lost.",
      "Verify EMER LT pb is guarded."
    ]},
    { title: "NO SMOKING AUTO", notes: [
      "AUTO enables automatic sign logic linked to gear/flaps.",
      "Use ON when required (turbulence/smoke)."
    ]},
    { title: "SEAT BELTS ON", notes: [
      "Set ON before push/taxi; coordinate with cabin crew.",
      "Expect 'Cabin Ready' before line-up."
    ]},
    { title: "NAV & LOGO LT POSITION 1", notes: [
      "Select position 1 (or 2 as alternate).",
      "Provides steady NAV lights; check exterior light config per SOP."
    ]},
    { title: "FUEL PUMPS ON", notes: [
      "All tank pumps ON to ensure feed pressure before start.",
      "Verify ECAM FUEL page shows pressure available."
    ]}
  ],
  "Pre-Departure Clearance (CPDLC)": [
    { title: "CHECK ATIS & METAR", notes: [
      "Obtain current ATIS/METAR before clearance.",
    ]},
    { title: "STAND NUMBER | DESTINATION | INFORMATION (for voice clearance)", notes: [
      "Prepare info for ATC readout: stand position, departure/destination aerodromes, flight number.",
      "Facilitates correct and efficient clearance delivery."
    ]},
    { title: "MCDU MENU > ATSU > AOC MENU > FLT INIT > INIT DATA REQ", notes: [
      "Request flight data uplink via ACARS/AOC.",
    ]},
    { title: "MCDU MENU > ATSU > AOC MENU > ATC REQ > PRE DEP CLRNCE > FILL > SEND", notes: [
      "Send Pre-Departure Clearance request via CPDLC.",
      "Verify uplinked clearance (SID, squawk, level) before acceptance."
    ]},
    { title: "DEPARTURE SID CHECK & SET", notes: [
      "Confirm assigned SID loaded in MCDU F-PLN.",
    ]},
    { title: "SQUAWK SET", notes: [
      "Insert assigned squawk code in transponder.",
    ]},
    { title: "BARO REF SET BOTH", notes: [
      "Set QNH on both PFDs.",
      "Perform cross-check: max 100 ft difference between instruments."
    ]},
    { title: "INITIAL CLIMB SET", notes: [
      "Insert cleared initial climb altitude/heading in FCU.",
      "Brief any noise abatement or SID-related constraints."
    ]}
  ]
};

/* =========================================================
   🔗 GLOBAL DURUM
   - currentItemEl: modal ile ilgili o anki madde referansı
   ========================================================= */
let currentItemEl = null;

/* =========================================================
   🔎 DOM REFERANSLARI (Modal ve Kontroller)
   - Modal elemanları ve butonlar
   ========================================================= */
const modal      = document.getElementById('descModal');
const modalTitle = document.getElementById('descTitle');
const modalBody  = document.getElementById('descBody');
const copyBtn    = document.getElementById('copyBtn');
const closeBtn   = document.querySelector('.close-btn');

/* =========================================================
   🪟 MODAL YARDIMCILARI
   - attachModalClosers: ESC, backdrop, X ile kapatma
   - openDesc / closeDesc: açıklama modalını aç/kapa
   ========================================================= */
function attachModalClosers(){
  // X ile kapat
  if (closeBtn) {
    closeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      closeDesc();
    });
  }
  // Backdrop tıklaması ile kapat
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeDesc();
    });
  }
  // ESC ile kapat
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal?.classList.contains('show')) {
      closeDesc();
    }
  });
}

function openDesc(key){
  const safeKey = normalizeKey(key);
  const text = FCOM_NOTES[safeKey];

  if (modalTitle) modalTitle.textContent = key;
  if (modalBody) {
    modalBody.innerHTML = text
      ? text
      : "No description has been entered for this item yet.";
  }
  modal?.classList.add('show');

  if (!currentItemEl) {
    currentItemEl = document.querySelector(`.item[data-key="${safeKey}"]`);
  }
  // Erişilebilirlik: modal açılınca hızlıca X butonuna odaklan
  setTimeout(() => closeBtn?.focus(), 10);
}

function closeDesc(){
  modal?.classList.remove('show');
  currentItemEl = null;
}

/* =========================================================
   ✏️ BUILDER: Madde satırlarını (l ... r) yapısına dönüştürme
   - buildLeaders: "LEFT .... RIGHT" ayrışması ve ? butonu ekleme
   ========================================================= */
function buildLeaders() {
  document.querySelectorAll('.item p').forEach(p => {
    const rawOriginal = p.textContent;
    const raw = rawOriginal.replace(/\s+/g, ' ').trim();
    let left = "", right = "";

    // 1) Kullanıcı iki+ boşlukla manuel ayırmışsa
    const manual = rawOriginal.match(/^(.*?)\s{2,}(.*)$/);
    if (manual) {
      left  = manual[1].trim();
      right = manual[2].trim();
    } else {
      // 2) Nokta/boşluk lideri ile ayır
      const m = raw.match(/^(.*?)[.\s]{4,}(.*)$/);
      if (m) {
        left  = m[1].trim();
        right = m[2].trim();
      } else {
        // 3) Son kelimeyi sağa at (varsayılan)
        const parts = raw.split(' ');
        right = parts.pop();
        left  = parts.join(' ');
      }
    }

    const itemEl = p.closest('.item');
    itemEl.dataset.key = normalizeKey(rawOriginal);

    // İçeriği yapılandır
    p.innerHTML = `
      <span class="l">${left}</span>
      <span class="dotfill" aria-hidden="true"></span>
      <span class="r">${right}</span>
    `;

    // .no-info ise buton ekleme
    if (itemEl.classList.contains('no-info')) return;

    // Info (?) butonu ekle ve olaylarını bağla
    const info = document.createElement('span');
    info.className = 'info-btn';
    info.setAttribute('role', 'button');
    info.setAttribute('tabindex', '0');
    info.setAttribute('aria-label', 'Açıklamayı göster');
    info.textContent = '?';
    info.addEventListener('click', (ev) => {
      ev.stopPropagation();
      currentItemEl = itemEl;
      openDesc(itemEl.dataset.key);
    });
    info.addEventListener('keydown', (ev) => {
      if (ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        ev.stopPropagation();
        currentItemEl = itemEl;
        openDesc(itemEl.dataset.key);
      }
    });
    itemEl.appendChild(info);
  });
}

/* =========================================================
   ✅ TAMAMLANMA / İLERLEME MANTIĞI
   - checkCompletion: oran hesaplar, başlığı .completed yapar
     % barını günceller, tamamlanınca maddeleri gizler (hidden)
   ========================================================= */
function checkCompletion(topicEl){
  const items = topicEl.querySelectorAll('.item');
  const done  = topicEl.querySelectorAll('.item.done');
  const ratio = items.length ? Math.round((done.length / items.length) * 100) : 0;

  // Tüm maddeler tamamlandı mı?
  topicEl.classList.toggle('completed', items.length === done.length && items.length > 0);

  // Opsiyonel ilerleme barı/metni güncelle
  const bar = topicEl.querySelector('.progress .bar');
  const txt = topicEl.querySelector('.progress-text');
  if (bar) bar.style.width = ratio + '%';
  if (txt) txt.textContent = ratio + '%';

  // Tamamlanınca tüm maddeleri gizle; değilse görünür yap
  if (items.length > 0 && items.length === done.length) {
    items.forEach(b => b.classList.add('hidden'));
  } else {
    items.forEach(b => b.classList.remove('hidden'));
  }
}

/* =========================================================
   📝 MADDE/RESET TIKLAMALARI
   - .item tık: done toggle → checkCompletion
   - [data-reset] tık: o topic içini sıfırla
   ========================================================= */
document.addEventListener('click', (e) => {
  const itemBtn  = e.target.closest('.item');
  const resetBtn = e.target.closest('[data-reset]');

  // Madde tıklaması (info-btn’e değilse)
  if (itemBtn && !e.target.classList.contains('info-btn')) {
    itemBtn.classList.toggle('done');
    checkCompletion(itemBtn.closest('.topic-box'));
    return;
  }

  // Bölüm reset butonu
  if (resetBtn) {
    const topic = resetBtn.closest('.topic-box');
    topic.querySelectorAll('.item').forEach(b => b.classList.remove('done', 'hidden'));
    topic.classList.remove('completed');
    checkCompletion(topic);
    return;
  }
});

/* =========================================================
   📋 MODAL KOPYALA → MADDEYİ TAMAMLA
   - copyBtn: tıklanınca ilgili maddeyi .done yapar, modalı kapatır
   ========================================================= */
if (copyBtn) {
  copyBtn.addEventListener('click', () => {
    if (currentItemEl) {
      currentItemEl.classList.add('done');
      checkCompletion(currentItemEl.closest('.topic-box'));
    }
    closeDesc();
  });
}

/* =========================================================
   🧩 .item içinde <p> olmayan durumlar için info butonu ekleme
   - addInfoForNonPItems: dataset.key atar ve tek bir ? butonu ekler
   ========================================================= */
(function addInfoForNonPItems(){
  document.querySelectorAll('.item').forEach(itemEl => {
    if (itemEl.classList.contains('no-info')) return;
    if (itemEl.querySelector('.info-btn')) return; // buildLeaders ile eklenmiş olabilir

    // Anahtar metni türet: header-line > .l > ilk <li> > ilk satır
    let keyText = '';
    const headerL = itemEl.querySelector('.header-line .l');
    if (headerL?.textContent.trim()) {
      keyText = headerL.textContent.trim();
    } else {
      const firstLi = itemEl.querySelector('ul li');
      if (firstLi) keyText = firstLi.textContent.trim();
      else keyText = (itemEl.textContent || '').trim().split('\n')[0];
    }
    itemEl.dataset.key = normalizeKey(keyText);

    // Info butonu ekle
    const info = document.createElement('span');
    info.className = 'info-btn';
    info.setAttribute('role','button');
    info.setAttribute('tabindex','0');
    info.setAttribute('aria-label','Açıklamayı göster');
    info.textContent = '?';
    info.addEventListener('click', (ev) => {
      ev.stopPropagation();
      currentItemEl = itemEl;
      openDesc(itemEl.dataset.key);
    });
    info.addEventListener('keydown', (ev) => {
      if (ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        ev.stopPropagation();
        currentItemEl = itemEl;
        openDesc(itemEl.dataset.key);
      }
    });
    itemEl.appendChild(info);
  });
})();

/* =========================================================
   🧾 GRUP NOTLARI MODALI (Alt liste barındıran .item için)
   - wireGroupInfo: topic başlığına göre GROUP_NOTES modalı açar
   ========================================================= */
(function wireGroupInfo(){
  document.querySelectorAll('.item').forEach(itemEl => {
    if (itemEl.classList.contains('no-info')) return;

    const hasSubList = !!itemEl.querySelector('.sub-list li');
    if (!hasSubList) return;

    // Tek bir info-btn olsun (per li değil)
    const infoBtn = itemEl.querySelector('.info-btn') || (() => {
      const b = document.createElement('span');
      b.className = 'info-btn';
      b.setAttribute('role','button');
      b.setAttribute('tabindex','0');
      b.setAttribute('aria-label','Açıklamayı göster');
      b.textContent = '?';
      itemEl.appendChild(b);
      return b;
    })();

    const sectionTitle =
      itemEl.closest('.topic-box')?.querySelector('h2')?.textContent?.trim() || "";

    infoBtn.onclick = (e) => {
      e.stopPropagation();
      currentItemEl = itemEl;

      const pack = GROUP_NOTES[sectionTitle];
      if (!pack) { openDesc(sectionTitle || 'Info'); return; }

      // Sıralı liste HTML’ini üret
      let html = '<ol style="padding-left:20px;margin:0;">';
      for (const it of pack) {
        html += '<li><b>' + it.title + '</b><ul style="margin:4px 0 10px 18px;">';
        for (const n of it.notes) html += '<li>' + n + '</li>';
        html += '</ul></li>';
      }
      html += '</ol>';

      // Modalı göster
      if (modalTitle) modalTitle.textContent = sectionTitle;
      if (modalBody)  modalBody.innerHTML  = html;
      modal?.classList.add('show');
    };

    infoBtn.onkeydown = (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        infoBtn.click();
      }
    };
  });
})();

/* =========================================================
   🎛️ TEMA / GLOBAL RESET / DOC INFO POPUP
   - Tema geçişi: body.light toggle + ikon değişimi
   - Global reset: tüm maddeleri/başlıkları sıfırlar
   - Doc Info: açık/kapalı toggle
   ========================================================= */
const themeToggle  = document.getElementById('themeToggle');
if (themeToggle) {
  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('light');
    themeToggle.textContent = document.body.classList.contains('light') ? '🌙' : '☀️';
  });
}

const globalReset = document.getElementById('globalReset');
if (globalReset) {
  globalReset.addEventListener('click', () => {
    document.querySelectorAll('.item').forEach(item => item.classList.remove('done','hidden'));
    document.querySelectorAll('.topic-box').forEach(topic => {
      topic.classList.remove('completed');
      checkCompletion(topic);
    });
  });
}

const openDocInfo  = document.getElementById('openDocInfo');
const docInfoModal = document.getElementById('docInfoModal');
const closeDocInfo = document.getElementById('closeDocInfo');

openDocInfo?.addEventListener('click', () => docInfoModal?.classList.add('show'));
closeDocInfo?.addEventListener('click', () => docInfoModal?.classList.remove('show'));
docInfoModal?.addEventListener('click', e => { if (e.target === docInfoModal) docInfoModal.classList.remove('show'); });


/* =========================================================
   🚀 BAŞLATMA
   - Modal kapatma bağları
   - Lider çizgileri ve info butonları
   - Başlangıç ilerleme hesapları
   ========================================================= */
buildLeaders();
attachModalClosers();
document.querySelectorAll('.topic-box').forEach(checkCompletion);


/* =========================================================
   ✏️ FCOM NOTE DÜZENLEME (KORUNAN YAPI)
   - Sadece açıklama metni düzenlenir, checklist yapısı etkilenmez
   ========================================================= */
const editBtn = document.getElementById('editBtn');
const saveEditBtn = document.getElementById('saveEditBtn');

let fcomEdits = {};
try {
  const data = localStorage.getItem('fcomEdits');
  if (data) fcomEdits = JSON.parse(data);
} catch(e){ fcomEdits = {}; }

function saveFcomEdits(){
  try { localStorage.setItem('fcomEdits', JSON.stringify(fcomEdits)); }
  catch(e){ console.error("Save edits error", e); }
}

const originalOpenDesc3 = openDesc;
openDesc = function(key){
  originalOpenDesc3(key);
  const safeKey = normalizeKey(key);
  if (fcomEdits[safeKey]){
    modalBody.textContent = fcomEdits[safeKey];
  }
  modalBody.setAttribute('contenteditable','false');
  if (editBtn) editBtn.style.display='inline-block';
  if (saveEditBtn) saveEditBtn.style.display='none';
};

if (editBtn){
  editBtn.addEventListener('click', ()=>{
    // Clear placeholder if present
    if (modalBody && modalBody.innerText.includes("No description has been entered for this item yet.")){
      modalBody.innerText = "";
    }
    modalBody.setAttribute('contenteditable','true');
    modalBody.focus();
    editBtn.style.display='none';
    saveEditBtn.style.display='inline-block';
  });
}

if (saveEditBtn){
  saveEditBtn.addEventListener('click', ()=>{
    const key = currentItemEl ? currentItemEl.dataset.key : null;
    if (key){
      fcomEdits[key] = modalBody.innerText;
      saveFcomEdits();
      // Removed alert here
    }
    modalBody.setAttribute('contenteditable','false');
    editBtn.style.display='inline-block';
    saveEditBtn.style.display='none';
  });
}

/* =========================================================
   💾 EXPORT TO HTML BUTTON (DISK ICON)
   ========================================================= */
const exportToggle = document.getElementById('exportToggle');
function exportToHtml(){
  let edits = {};
  try {
    const data = localStorage.getItem('fcomEdits');
    if (data) edits = JSON.parse(data);
  } catch(e){ edits = {}; }

  let content = document.documentElement.outerHTML;
  const rawRegex = /const FCOM_NOTES_RAW = {([\s\S]*?)};/;
  const m = content.match(rawRegex);
  if (!m){ alert("FCOM_NOTES_RAW not found!"); return; }

  let rawObjText = m[1];
  for (const [key,val] of Object.entries(edits)){
    const safeVal = val.replace(/"/g,'\\\"').replace(/\n/g,' ');
    const keyRegex = new RegExp('"' + key.replace(/[.*+?^${}()|[\\]\\]/g,'\\$&') + '"\\s*:\\s*"[^"]*"', 'g');
    rawObjText = rawObjText.replace(keyRegex, '"' + key + '":"' + safeVal + '"');
  }
  const newContent = content.replace(rawRegex, 'const FCOM_NOTES_RAW = {' + rawObjText + '};');

  const blob = new Blob([newContent], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'checklist_edited.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
if (exportToggle){
  exportToggle.addEventListener('click', exportToHtml);
}


/* =========================================================
   ➕ Add Row next to Reset, and edit/delete via modal header
   (Preserve dotfill & ? by always using <button class="item"><p>...</p></button> and running buildLeaders())
   ========================================================= */
function ensureActionsRow(){
  document.querySelectorAll('.topic-box').forEach(topicEl=>{
    const reset = topicEl.querySelector('[data-reset]');
    if(!reset) return;
    if(reset.closest('.actions')) return; // already wrapped
    const actions = document.createElement('div');
    actions.className = 'actions';
    reset.parentNode.insertBefore(actions, reset);
    actions.appendChild(reset);
    // Add "Add Row" button to the right of Reset
    const add = document.createElement('button');
    add.className = 'add-row';
    add.type = 'button';
    add.textContent = 'Add Row';
    add.addEventListener('click', ()=>{
      const text = prompt('Enter item text (e.g., LEFT .... RIGHT):');
      if(!text) return;
      const btn = document.createElement('button');
      btn.className = 'item custom';
      const p = document.createElement('p');
      p.textContent = text;
      btn.appendChild(p);
      // insert before actions row
      actions.parentNode.insertBefore(btn, actions);
      // Rebuild leaders to add dotfill and ? button
      buildLeaders();
      checkCompletion(topicEl);
      saveCustomItems();
    });
    actions.appendChild(add);
  });
}
ensureActionsRow();

/* Persist custom items (added rows) */
function loadCustomItems(){
  try{
    const data = localStorage.getItem('customItems');
    if(!data) return;
    const obj = JSON.parse(data);
    for(const [topicId, arr] of Object.entries(obj)){
      const topicEl = document.getElementById(topicId);
      if(!topicEl) continue;
      const actions = topicEl.querySelector('.actions') || topicEl.appendChild(document.createElement('div'));
      if(!actions.classList.contains('actions')){
        actions.className='actions';
        const reset = topicEl.querySelector('[data-reset]');
        if(reset) actions.appendChild(reset);
      }
      arr.forEach(text=>{
        const btn = document.createElement('button');
        btn.className = 'item custom';
        const p = document.createElement('p');
        p.textContent = text;
        btn.appendChild(p);
        topicEl.insertBefore(btn, actions);
      });
    }
    // After injecting, rebuild to attach dotfill and ? buttons
    buildLeaders();
    document.querySelectorAll('.topic-box').forEach(checkCompletion);
  }catch(e){ console.error(e); }
}

function saveCustomItems(){
  const payload = {};
  document.querySelectorAll('.topic-box').forEach(topicEl=>{
    const id = topicEl.id;
    const arr = [];
    topicEl.querySelectorAll('.item.custom').forEach(it=>{
      const t = it.querySelector('p')?.textContent.trim();
      if(t) arr.push(t);
    });
    if(arr.length) payload[id] = arr;
  });
  try{ localStorage.setItem('customItems', JSON.stringify(payload)); }
  catch(e){ console.error(e); }
}
// Load custom items now (after initial buildLeaders)
loadCustomItems();

/* Modal header buttons: Edit Item & Delete Item */
const editItemBtn = document.getElementById('editItemBtn');
const deleteItemBtn = document.getElementById('deleteItemBtn');

if(editItemBtn){
  editItemBtn.addEventListener('click', ()=>{
    if(!currentItemEl) return;
    const oldText = (currentItemEl.querySelector('p')?.textContent || '').trim();
    const text = prompt('Edit item text:', oldText);
    if(!text || text === oldText) return;
    const p = currentItemEl.querySelector('p') || currentItemEl.appendChild(document.createElement('p'));
    p.textContent = text;
    // Rebuild dotfill and ? button for this item only:
    buildLeaders(); // safe global rebuild to reattach ? if needed
    checkCompletion(currentItemEl.closest('.topic-box'));
    // If this was custom, persist updated text
    const topicEl = currentItemEl.closest('.topic-box');
    if(currentItemEl.classList.contains('custom')) saveCustomItems();
    // If not custom, we still want the text change to persist upon Export;
    // For now, text is only in DOM; Export will include DOM outerHTML, so OK.
  });
}

if(deleteItemBtn){
  deleteItemBtn.addEventListener('click', ()=>{
    if(!currentItemEl) return;
    const ok = confirm('Are you sure you want to delete this item?');
    if(!ok) return;
    const topicEl = currentItemEl.closest('.topic-box');
    // Remove from localStorage if custom
    if(currentItemEl.classList.contains('custom')){
      saveCustomItems(); // ensure latest before
      const data = localStorage.getItem('customItems');
      if(data){
        try{
          const obj = JSON.parse(data);
          const id = topicEl?.id;
          const txt = (currentItemEl.querySelector('p')?.textContent || '').trim();
          if(id && obj[id]){
            obj[id] = obj[id].filter(t => t.trim() != txt);
            localStorage.setItem('customItems', JSON.stringify(obj));
          }
        }catch(e){ console.error(e); }
      }
    }
    currentItemEl.remove();
    checkCompletion(topicEl);
    closeDesc();
  });
}

/* Rename modal body edit/save buttons: footer already changed to "Update Note" above */


/* =========================================================
   ♻️ RESTORE ORIGINAL (Safe reload so CSS/JS re-init properly)
   - Clears localStorage keys
   - Forces a hard reload with a cache-busting query string
   ========================================================= */
const restoreToggle = document.getElementById('restoreToggle');

function restoreOriginal(){
  const ok = confirm('Restore the original version? All your unsaved changes will be lost.');
  if(!ok) return;
  try{
    localStorage.removeItem('fcomEdits');
    localStorage.removeItem('customItems');
    localStorage.removeItem('userNotes');
  }catch(e){ console.error(e); }
  // Force a hard reload to re-run scripts & styles
  const url = new URL(window.location.href);
  url.searchParams.set('restored', '1');
  url.searchParams.set('ts', String(Date.now()));
  window.location.replace(url.toString());
}

if (restoreToggle){
  restoreToggle.addEventListener('click', restoreOriginal);
}



document.addEventListener('DOMContentLoaded', ()=>{
  const infoToggle = document.getElementById('infoToggle');
  const infoModal  = document.getElementById('infoModal');
  const closeInfo  = document.getElementById('closeInfo');

  if (infoToggle){
    infoToggle.addEventListener('click', ()=>{
      const m = document.getElementById('infoModal');
      m?.classList.add('show');
    });
  }
  if (closeInfo){
    closeInfo.addEventListener('click', ()=>{
      const m = document.getElementById('infoModal');
      m?.classList.remove('show');
    });
  }
  const m = document.getElementById('infoModal');
  if (m){
    m.addEventListener('click', (e)=>{
      if(e.target === m) m.classList.remove('show');
    });
  }
});

</script>
<div aria-labelledby="infoTitle" aria-modal="true" class="modal" id="infoModal" role="dialog">
<div class="modal-card">
<div class="modal-header">
<div class="modal-title" id="infoTitle">How to Use This Checklist</div>
<button class="close-btn" id="closeInfo">×</button>
</div>
<div class="modal-body">
<ul>
<li>Click an item to mark it as completed. Completed items will hide automatically.</li>
<li>Click the "?" button next to an item to view detailed Item notes.</li>
<li>Use the <b>Reset</b> button to reset all items in that section.</li>
<li>Use the <b>Add Row</b> button to insert your own checklist items.</li>
<li><b>Delete items:</b> In the Item note window, you can delete the current item with <i>Delete Item</i>. Custom rows are removed permanently; default rows return if you restore the original file.</li>
<li><b>Edit explanations:</b> Click <i>Update Note</i> to edit the item note text, then <i>Save</i>.</li>
<li>Top-right buttons allow theme change (☀️/🌙), saving your edits (💾), and restoring defaults (⟲).</li>
<li>Your notes and changes are saved locally in your browser and included when you export the file.</li>
</ul>
</div>
</div>
</div>
</body>
</html>
